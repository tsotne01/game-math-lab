---
import ModuleLayout from '../../../layouts/ModuleLayout.astro';
import VectorVisualizer, { DotProductVisualizer } from '../../../components/modules/VectorVisualizer';
import Pong from '../../../components/modules/Pong';
import Quiz from '../../../components/lessons/Quiz';
import MarkComplete from '../../../components/ui/MarkComplete';
import CodeBlock from '../../../components/ui/CodeBlock';
import type { QuizQuestion } from '../../../components/lessons/Quiz';

// Quiz questions for Module 01
const quizQuestions: QuizQuestion[] = [
  {
    type: 'multiple-choice',
    question: 'What does normalizing a vector do?',
    options: [
      'Makes it longer',
      'Makes it have length 1',
      'Rotates it 90 degrees',
      'Reverses its direction'
    ],
    correctIndex: 1,
    explanation: 'Normalizing a vector scales it to have a magnitude (length) of exactly 1, while preserving its direction. This is useful when you only care about direction, not magnitude.'
  },
  {
    type: 'multiple-choice',
    question: 'If vector A = (3, 4), what is its magnitude?',
    options: ['7', '12', '5', '1'],
    correctIndex: 2,
    explanation: 'The magnitude is calculated using the Pythagorean theorem: √(3² + 4²) = √(9 + 16) = √25 = 5. This is a classic 3-4-5 right triangle!'
  },
  {
    type: 'multiple-choice',
    question: 'What does a dot product of 0 mean?',
    options: [
      'Vectors are parallel',
      'Vectors are perpendicular',
      'Vectors are opposite',
      'One vector is zero'
    ],
    correctIndex: 1,
    explanation: 'When the dot product is 0, the vectors are perpendicular (at 90° to each other). Positive means they point roughly the same way, negative means roughly opposite.'
  },
  {
    type: 'code-completion',
    question: 'Complete the vector addition function:',
    codeTemplate: `function add(v1, v2) {
  return { x: v1.x + ___, y: v1.y + ___ };
}`,
    answers: ['v2.x', 'v2.y'],
    explanation: 'Vector addition is component-wise: add the x components together and the y components together. This combines the effects of both vectors.'
  },
  {
    type: 'multiple-choice',
    question: 'AABB collision checks if two _____ overlap.',
    options: ['Circles', 'Triangles', 'Rectangles', 'Lines'],
    correctIndex: 2,
    explanation: 'AABB stands for Axis-Aligned Bounding Box. It\'s the simplest collision detection for rectangles that are aligned with the x and y axes (not rotated).'
  }
];

// Code snippets as strings to avoid JSX parsing issues
const codeBasicVector = `// A simple 2D vector
const position = { x: 100, y: 200 };
const velocity = { x: 5, y: -3 };

// Moving an object
position.x += velocity.x;
position.y += velocity.y;`;

const codeVectorAdd = `// Vector addition
function add(v1, v2) {
    return { x: v1.x + v2.x, y: v1.y + v2.y };
}

// Apply velocity to position
position = add(position, velocity);`;

const codeMagnitude = `function magnitude(v) {
    return Math.sqrt(v.x * v.x + v.y * v.y);
}

// Example: speed = magnitude of velocity
const speed = magnitude(velocity);`;

const codeNormalize = `function normalize(v) {
    const mag = magnitude(v);
    if (mag === 0) return { x: 0, y: 0 };
    return { x: v.x / mag, y: v.y / mag };
}

// Get direction, then scale to desired speed
const direction = normalize(velocity);
const newVelocity = { 
    x: direction.x * desiredSpeed, 
    y: direction.y * desiredSpeed 
};`;

const codeDot = `function dot(v1, v2) {
    return v1.x * v2.x + v1.y * v2.y;
}`;

const codeAABB = `function aabbCollision(rect1, rect2) {
    return rect1.x < rect2.x + rect2.width &&
           rect1.x + rect1.width > rect2.x &&
           rect1.y < rect2.y + rect2.height &&
           rect1.y + rect1.height > rect2.y;
}`;
---

<ModuleLayout 
  title="Vector Math Fundamentals"
  moduleNumber="01"
  projectName="Pong Clone"
  nextModule={{ href: '/modules/02-trigonometry/', title: 'Trigonometry in Action' }}
>
  <!-- Lesson 1: What is a Vector? -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-accent mb-4">1. What is a Vector?</h2>
    
    <p class="text-text-secondary mb-4">
      A <strong class="text-white">vector</strong> is simply a way to represent both 
      <em>direction</em> and <em>magnitude</em> (length). In game development, we use 
      vectors constantly for:
    </p>
    
    <ul class="list-none space-y-2 mb-6 text-text-secondary">
      <li class="flex items-start gap-2"><svg class="w-5 h-5 text-accent flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"/><circle cx="12" cy="10" r="3"/></svg><span><strong class="text-white">Position</strong> - Where is the player? <code>(x: 100, y: 200)</code></span></li>
      <li class="flex items-start gap-2"><svg class="w-5 h-5 text-accent flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></svg><span><strong class="text-white">Velocity</strong> - How fast and in what direction? <code>(vx: 5, vy: -3)</code></span></li>
      <li class="flex items-start gap-2"><svg class="w-5 h-5 text-accent flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg><span><strong class="text-white">Acceleration</strong> - How is velocity changing?</span></li>
      <li class="flex items-start gap-2"><svg class="w-5 h-5 text-accent flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg><span><strong class="text-white">Direction</strong> - Which way is the enemy facing?</span></li>
    </ul>
    
    <p class="text-text-secondary mb-6">
      In 2D games, a vector is just two numbers: <code>x</code> and <code>y</code>.
    </p>

    <CodeBlock client:load code={codeBasicVector} language="javascript" />

    <VectorVisualizer client:visible />
  </section>

  <!-- Lesson 2: Vector Operations -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-accent mb-4">2. Essential Vector Operations</h2>
    
    <h3 class="text-xl font-semibold text-white mt-8 mb-3">Addition & Subtraction</h3>
    <p class="text-text-secondary mb-4">
      Adding vectors is component-wise: add the x's together, add the y's together.
    </p>
    
    <CodeBlock client:load code={codeVectorAdd} language="javascript" />

    <h3 class="text-xl font-semibold text-white mt-8 mb-3">Magnitude (Length)</h3>
    <p class="text-text-secondary mb-4">
      How long is the vector? Use Pythagorean theorem.
    </p>
    
    <CodeBlock client:load code={codeMagnitude} language="javascript" />

    <h3 class="text-xl font-semibold text-white mt-8 mb-3">Normalization</h3>
    <p class="text-text-secondary mb-4">
      A <strong class="text-white">normalized</strong> vector has length 1. It represents pure direction.
    </p>
    
    <CodeBlock client:load code={codeNormalize} language="javascript" />
  </section>

  <!-- Lesson 3: Dot Product -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-accent mb-4">3. The Dot Product</h2>
    
    <p class="text-text-secondary mb-4">
      The <strong class="text-white">dot product</strong> tells you how much two vectors 
      point in the same direction.
    </p>
    
    <CodeBlock client:load code={codeDot} language="javascript" />

    <p class="text-text-secondary mb-4">What does the result mean?</p>
    
    <ul class="list-none space-y-2 mb-6 text-text-secondary">
      <li><strong class="text-[#00b894]">Positive:</strong> Vectors point roughly the same way</li>
      <li><strong class="text-[#fdcb6e]">Zero:</strong> Vectors are perpendicular (90°)</li>
      <li><strong class="text-[#e17055]">Negative:</strong> Vectors point roughly opposite ways</li>
    </ul>

    <p class="text-text-secondary mb-6">
      In Pong, we use dot product to reflect the ball off paddles correctly!
    </p>

    <DotProductVisualizer client:visible />
  </section>

  <!-- Lesson 4: AABB Collision -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-accent mb-4">4. AABB Collision Detection</h2>
    
    <p class="text-text-secondary mb-4">
      <strong class="text-white">AABB</strong> stands for Axis-Aligned Bounding Box. 
      It's the simplest collision check for rectangles.
    </p>
    
    <CodeBlock client:load code={codeAABB} language="javascript" />

    <p class="text-text-secondary">
      For Pong, we check if the ball's bounding box overlaps with a paddle's bounding box.
    </p>
  </section>

  <!-- Project: Pong -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-accent mb-4 flex items-center gap-2">
      <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="6" x2="10" y1="11" y2="11"/><line x1="8" x2="8" y1="9" y2="13"/><line x1="15" x2="15.01" y1="12" y2="12"/><line x1="18" x2="18.01" y1="10" y2="10"/><path d="M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z"/></svg>
      Project: Pong
    </h2>
    
    <p class="text-text-secondary mb-6">
      Now let's put it all together! This Pong game uses everything we learned:
    </p>
    
    <ul class="list-none space-y-2 mb-8 text-text-secondary">
      <li class="flex items-center gap-2"><svg class="w-4 h-4 text-[#00b894]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg> Vectors for ball position and velocity</li>
      <li class="flex items-center gap-2"><svg class="w-4 h-4 text-[#00b894]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg> Vector reflection for bouncing</li>
      <li class="flex items-center gap-2"><svg class="w-4 h-4 text-[#00b894]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg> AABB collision for paddle hits</li>
      <li class="flex items-center gap-2"><svg class="w-4 h-4 text-[#00b894]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg> Magnitude for speed control</li>
    </ul>

    <Pong client:visible />
  </section>

  <!-- Quiz -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-accent mb-4 flex items-center gap-2">
      <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"/></svg>
      Knowledge Check
    </h2>
    
    <p class="text-text-secondary mb-6">
      Test your understanding of vector math concepts before moving on!
    </p>

    <Quiz 
      client:visible
      title="Vector Math Quiz"
      questions={quizQuestions}
    />
  </section>

  <!-- Mark Complete -->
  <section class="mb-16 py-8 border-y border-border">
    <MarkComplete 
      client:load 
      moduleId="01-vectors" 
      moduleName="Vector Math Fundamentals"
    />
  </section>

  <!-- Challenges -->
  <section class="mb-8">
    <h2 class="text-2xl font-bold text-accent mb-4 flex items-center gap-2">
      <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m14.5 12.5-5 5"/><path d="m9.5 12.5 5 5"/><path d="M6 10h4"/><path d="M8 8v4"/><path d="M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z"/></svg>
      Challenges
    </h2>
    
    <p class="text-text-secondary mb-4">
      Completed the project? Try these extensions:
    </p>
    
    <ol class="list-decimal list-inside space-y-3 text-text-secondary">
      <li>
        <strong class="text-white">Speed Increase:</strong> Make the ball faster after each paddle hit
      </li>
      <li>
        <strong class="text-white">Angle Control:</strong> Change ball angle based on where it hits the paddle
      </li>
      <li>
        <strong class="text-white">AI Opponent:</strong> Make the AI paddle track the ball with some delay
      </li>
      <li>
        <strong class="text-white">Power-ups:</strong> Add items that change paddle size or ball speed
      </li>
    </ol>
  </section>
</ModuleLayout>
