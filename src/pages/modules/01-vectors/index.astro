---
import ModuleLayout from '../../../layouts/ModuleLayout.astro';
import VectorVisualizer, { DotProductVisualizer } from '../../../components/modules/VectorVisualizer';
import Pong from '../../../components/modules/Pong';
import Quiz from '../../../components/lessons/Quiz';
import type { QuizQuestion } from '../../../components/lessons/Quiz';

// Quiz questions for Module 01
const quizQuestions: QuizQuestion[] = [
  {
    type: 'multiple-choice',
    question: 'What does normalizing a vector do?',
    options: [
      'Makes it longer',
      'Makes it have length 1',
      'Rotates it 90 degrees',
      'Reverses its direction'
    ],
    correctIndex: 1,
    explanation: 'Normalizing a vector scales it to have a magnitude (length) of exactly 1, while preserving its direction. This is useful when you only care about direction, not magnitude.'
  },
  {
    type: 'multiple-choice',
    question: 'If vector A = (3, 4), what is its magnitude?',
    options: ['7', '12', '5', '1'],
    correctIndex: 2,
    explanation: 'The magnitude is calculated using the Pythagorean theorem: ‚àö(3¬≤ + 4¬≤) = ‚àö(9 + 16) = ‚àö25 = 5. This is a classic 3-4-5 right triangle!'
  },
  {
    type: 'multiple-choice',
    question: 'What does a dot product of 0 mean?',
    options: [
      'Vectors are parallel',
      'Vectors are perpendicular',
      'Vectors are opposite',
      'One vector is zero'
    ],
    correctIndex: 1,
    explanation: 'When the dot product is 0, the vectors are perpendicular (at 90¬∞ to each other). Positive means they point roughly the same way, negative means roughly opposite.'
  },
  {
    type: 'code-completion',
    question: 'Complete the vector addition function:',
    codeTemplate: `function add(v1, v2) {
  return { x: v1.x + ___, y: v1.y + ___ };
}`,
    answers: ['v2.x', 'v2.y'],
    explanation: 'Vector addition is component-wise: add the x components together and the y components together. This combines the effects of both vectors.'
  },
  {
    type: 'multiple-choice',
    question: 'AABB collision checks if two _____ overlap.',
    options: ['Circles', 'Triangles', 'Rectangles', 'Lines'],
    correctIndex: 2,
    explanation: 'AABB stands for Axis-Aligned Bounding Box. It\'s the simplest collision detection for rectangles that are aligned with the x and y axes (not rotated).'
  }
];

// Code snippets as strings to avoid JSX parsing issues
const codeBasicVector = `// A simple 2D vector
const position = { x: 100, y: 200 };
const velocity = { x: 5, y: -3 };

// Moving an object
position.x += velocity.x;
position.y += velocity.y;`;

const codeVectorAdd = `// Vector addition
function add(v1, v2) {
    return { x: v1.x + v2.x, y: v1.y + v2.y };
}

// Apply velocity to position
position = add(position, velocity);`;

const codeMagnitude = `function magnitude(v) {
    return Math.sqrt(v.x * v.x + v.y * v.y);
}

// Example: speed = magnitude of velocity
const speed = magnitude(velocity);`;

const codeNormalize = `function normalize(v) {
    const mag = magnitude(v);
    if (mag === 0) return { x: 0, y: 0 };
    return { x: v.x / mag, y: v.y / mag };
}

// Get direction, then scale to desired speed
const direction = normalize(velocity);
const newVelocity = { 
    x: direction.x * desiredSpeed, 
    y: direction.y * desiredSpeed 
};`;

const codeDot = `function dot(v1, v2) {
    return v1.x * v2.x + v1.y * v2.y;
}`;

const codeAABB = `function aabbCollision(rect1, rect2) {
    return rect1.x < rect2.x + rect2.width &&
           rect1.x + rect1.width > rect2.x &&
           rect1.y < rect2.y + rect2.height &&
           rect1.y + rect1.height > rect2.y;
}`;
---

<ModuleLayout 
  title="Vector Math Fundamentals"
  moduleNumber="01"
  projectName="Pong Clone"
  nextModule={{ href: '/modules/02-trigonometry/', title: 'Trigonometry in Action' }}
>
  <!-- Lesson 1: What is a Vector? -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-accent mb-4">1. What is a Vector?</h2>
    
    <p class="text-text-secondary mb-4">
      A <strong class="text-white">vector</strong> is simply a way to represent both 
      <em>direction</em> and <em>magnitude</em> (length). In game development, we use 
      vectors constantly for:
    </p>
    
    <ul class="list-none space-y-2 mb-6 text-text-secondary">
      <li>üìç <strong class="text-white">Position</strong> - Where is the player? <code>(x: 100, y: 200)</code></li>
      <li>üöÄ <strong class="text-white">Velocity</strong> - How fast and in what direction? <code>(vx: 5, vy: -3)</code></li>
      <li>üí® <strong class="text-white">Acceleration</strong> - How is velocity changing?</li>
      <li>üéØ <strong class="text-white">Direction</strong> - Which way is the enemy facing?</li>
    </ul>
    
    <p class="text-text-secondary mb-6">
      In 2D games, a vector is just two numbers: <code>x</code> and <code>y</code>.
    </p>

    <div class="bg-bg-card rounded-xl p-6 mb-6">
      <pre class="text-sm overflow-x-auto"><code set:text={codeBasicVector} /></pre>
    </div>

    <VectorVisualizer client:visible />
  </section>

  <!-- Lesson 2: Vector Operations -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-accent mb-4">2. Essential Vector Operations</h2>
    
    <h3 class="text-xl font-semibold text-white mt-8 mb-3">Addition & Subtraction</h3>
    <p class="text-text-secondary mb-4">
      Adding vectors is component-wise: add the x's together, add the y's together.
    </p>
    
    <div class="bg-bg-card rounded-xl p-6 mb-6">
      <pre class="text-sm overflow-x-auto"><code set:text={codeVectorAdd} /></pre>
    </div>

    <h3 class="text-xl font-semibold text-white mt-8 mb-3">Magnitude (Length)</h3>
    <p class="text-text-secondary mb-4">
      How long is the vector? Use Pythagorean theorem.
    </p>
    
    <div class="bg-bg-card rounded-xl p-6 mb-6">
      <pre class="text-sm overflow-x-auto"><code set:text={codeMagnitude} /></pre>
    </div>

    <h3 class="text-xl font-semibold text-white mt-8 mb-3">Normalization</h3>
    <p class="text-text-secondary mb-4">
      A <strong class="text-white">normalized</strong> vector has length 1. It represents pure direction.
    </p>
    
    <div class="bg-bg-card rounded-xl p-6 mb-6">
      <pre class="text-sm overflow-x-auto"><code set:text={codeNormalize} /></pre>
    </div>
  </section>

  <!-- Lesson 3: Dot Product -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-accent mb-4">3. The Dot Product</h2>
    
    <p class="text-text-secondary mb-4">
      The <strong class="text-white">dot product</strong> tells you how much two vectors 
      point in the same direction.
    </p>
    
    <div class="bg-bg-card rounded-xl p-6 mb-6">
      <pre class="text-sm overflow-x-auto"><code set:text={codeDot} /></pre>
    </div>

    <p class="text-text-secondary mb-4">What does the result mean?</p>
    
    <ul class="list-none space-y-2 mb-6 text-text-secondary">
      <li><strong class="text-[#00b894]">Positive:</strong> Vectors point roughly the same way</li>
      <li><strong class="text-[#fdcb6e]">Zero:</strong> Vectors are perpendicular (90¬∞)</li>
      <li><strong class="text-[#e17055]">Negative:</strong> Vectors point roughly opposite ways</li>
    </ul>

    <p class="text-text-secondary mb-6">
      In Pong, we use dot product to reflect the ball off paddles correctly!
    </p>

    <DotProductVisualizer client:visible />
  </section>

  <!-- Lesson 4: AABB Collision -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-accent mb-4">4. AABB Collision Detection</h2>
    
    <p class="text-text-secondary mb-4">
      <strong class="text-white">AABB</strong> stands for Axis-Aligned Bounding Box. 
      It's the simplest collision check for rectangles.
    </p>
    
    <div class="bg-bg-card rounded-xl p-6 mb-6">
      <pre class="text-sm overflow-x-auto"><code set:text={codeAABB} /></pre>
    </div>

    <p class="text-text-secondary">
      For Pong, we check if the ball's bounding box overlaps with a paddle's bounding box.
    </p>
  </section>

  <!-- Project: Pong -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-accent mb-4">üéÆ Project: Pong</h2>
    
    <p class="text-text-secondary mb-6">
      Now let's put it all together! This Pong game uses everything we learned:
    </p>
    
    <ul class="list-none space-y-2 mb-8 text-text-secondary">
      <li>‚úì Vectors for ball position and velocity</li>
      <li>‚úì Vector reflection for bouncing</li>
      <li>‚úì AABB collision for paddle hits</li>
      <li>‚úì Magnitude for speed control</li>
    </ul>

    <Pong client:visible />
  </section>

  <!-- Quiz -->
  <section class="mb-16">
    <h2 class="text-2xl font-bold text-accent mb-4">üìù Knowledge Check</h2>
    
    <p class="text-text-secondary mb-6">
      Test your understanding of vector math concepts before moving on!
    </p>

    <Quiz 
      client:visible
      title="Vector Math Quiz"
      questions={quizQuestions}
    />
  </section>

  <!-- Challenges -->
  <section class="mb-8">
    <h2 class="text-2xl font-bold text-accent mb-4">üí™ Challenges</h2>
    
    <p class="text-text-secondary mb-4">
      Completed the project? Try these extensions:
    </p>
    
    <ol class="list-decimal list-inside space-y-3 text-text-secondary">
      <li>
        <strong class="text-white">Speed Increase:</strong> Make the ball faster after each paddle hit
      </li>
      <li>
        <strong class="text-white">Angle Control:</strong> Change ball angle based on where it hits the paddle
      </li>
      <li>
        <strong class="text-white">AI Opponent:</strong> Make the AI paddle track the ball with some delay
      </li>
      <li>
        <strong class="text-white">Power-ups:</strong> Add items that change paddle size or ball speed
      </li>
    </ol>
  </section>
</ModuleLayout>
